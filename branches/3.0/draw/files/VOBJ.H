void drawobj(const char *name);
void redraw();

void quit()
{
	cleardevice();
	closegraph();
	clrscr();
	printf("This was generated by AxeShove McClion's DRAW");
	exit(0);
}

void error(const char *msg)
{
	fprintf(stderr,"ERROR in module: %s",msg);
  //	fprintf(stderr,"Line Number : %d",line);
  //	fprintf(stderr,"File Name   : %s",file);
	getch();
	exit(1);
}


void changeprop(const char *name,const char *prop,const char *val)
{
	FILE *fp,*prog;

	prog=fopen("\\$$$.$$$","at");
	fp=fopen("\\cmd.$$$","rt");

	if (fp == NULL) error("FP not available");
	if (prog==NULL) error("prog");

	char *buffer;
	int modify=0;

	buffer=(char *)calloc(1,100);
	if (buffer == NULL) error("buffer");

	while (!feof(fp))
	{
		strcpy(buffer,NULL);
		fscanf(fp,"%s",buffer);

		if (strcmp(buffer,name) == 0)
			modify  = 1;
				if (strncmp(buffer,prop,strlen(prop)) ==0 && modify == 1)
				{
				fprintf(prog,"%s=%s\n",prop,val);
				modify=0;
				}
		else
			fprintf(prog,"%s\n",buffer);
	}//end of while
	fclose(fp);
	fclose(prog);

	remove("\\cmd.$$$");
	rename("\\$$$.$$$","\\cmd.$$$");
	free(buffer);
}//end of change property


int add(char *type,char *name,int sx,int sy,int ex,int ey)
{
	bind_mouse(3,10,getmaxx(),getmaxy());
	FILE *fp,*prog;

	setactivepage(1);
	redraw();
	setactivepage(0);
	hide_mouse();
	switch(*type)
	{
	case 'c':
		fp=fopen("cmdobj.vbc","rt");break;
	case 'l':
		fp=fopen("lblobj.vbc","rt");break;
	case 't':
		fp=fopen("txtobj.vbc","rt");break;
	default:
		return 0;
	}

	prog=fopen("\\cmd.$$$","at");

	if (prog == NULL)
		error("Error opening temporary file");
	if (fp == NULL)
		error("Error opening object file\nMake sure that the object file exists");

	char *buffer = (char *)calloc(1,80);
	while (!feof(fp) )
	{
		fscanf(fp,"%s",buffer);
		if (strcmp(buffer,"[properties]") == 0)
		{
				fscanf(fp,"%s",buffer);
			while (strcmp(buffer,"[end]") != 0)
			{
				if (strcmp(buffer,type)==0)
					fprintf(prog,"%s\n",name);
				else
					fprintf(prog,"%s\n",buffer);
				fscanf(fp,"%s",buffer);
			}//end of properties while
			break;
		}//end of if
	}//end of while
	free(buffer);
	fclose(fp);
	fclose(prog);


	char *uffer =(char *)calloc(1,80);

	if (sx >ex)  {int t=sx;sx=ex;ex=t;}
	if (sy >ey)  {int t=sy;sy=ey;ey=t;}

	sprintf(uffer,"%d",sx);
	changeprop(name,"x2",uffer);
	sprintf(uffer,"%d",sy);
	changeprop(name,"y2",uffer);
	sprintf(uffer,"%d",ex);
	changeprop(name,"x1",uffer);
	sprintf(uffer,"%d",ey);
	changeprop(name,"y1",uffer);

int y3= (abs(ey+sy)-textheight("Command"))/2;
int x3= (abs(sx+ex)-textwidth("Command"))/2;

	sprintf(uffer,"%d",y3);
	changeprop(name,"y3",uffer);
	sprintf(uffer,"%d",x3);
	changeprop(name,"x3",uffer);
	free(uffer);

	drawobj(name);
	show_mouse();
	return 0;
}//end of add
